<launch>
  <!-- 实验3：机器人理论 cube_center vs 视觉融合 cube_center 残差对比 -->

  <arg name="ip" default="192.168.1.100" />
  <arg name="urdf_file" default="$(find jaka_close_contro)/urdf/jaka_zu3.urdf" />
  <arg name="faces_yaml" default="$(find jaka_close_contro)/config/cube_faces_current.yaml" />
  <arg name="extrinsic_yaml" default="$(find jaka_close_contro)/config/world_robot_extrinsic.yaml" />
  <arg name="tool_offset_yaml" default="$(find jaka_close_contro)/config/tool_offset_current.yaml" />
  <arg name="output_csv" default="$(find jaka_close_contro)/config/cube_nominal_compare.csv" />

  <!-- 0. 官方驱动 + TF 发布（含 /jaka_driver/linear_move 与 /joint_states） -->
  <include file="$(find jaka_close_contro)/launch/jaka_sdk_bringup.launch">
    <arg name="ip" value="$(arg ip)" />
    <arg name="urdf_file" value="$(arg urdf_file)" />
  </include>

  <!-- 3. 世界->基座外参广播 -->
  <node pkg="jaka_close_contro" type="world_robot_extrinsic_broadcaster_node" name="world_robot_extrinsic_broadcaster" output="screen">
    <param name="extrinsic_yaml" value="$(arg extrinsic_yaml)" />
    <param name="world_frame" value="world" />
    <param name="robot_base_frame" value="Link_0" />
    <param name="use_static" value="true" />
  </node>

  <!-- 4. 相机与 ArUco 检测/分流/世界板定义/多面融合 -->
  <include file="$(find jaka_close_contro)/launch/cube_fusion_debug.launch">
    <arg name="faces_yaml" value="$(arg faces_yaml)" />
    <arg name="tool_offset_yaml" value="$(arg tool_offset_yaml)" />
    <arg name="output_csv" value="" />
  </include>

  <!-- 补充世界坐标系定义（world -> camera），供 base->cam 计算使用 -->
  <node pkg="jaka_close_contro" type="world_tag_node" name="world_tag_node" output="screen">
    <param name="world_fiducial_id" value="500" />
    <param name="fiducial_topic"    value="/world_fiducials" />
    <param name="world_frame"       value="world" />
    <param name="camera_frame"      value="zed2i_left_camera_optical_frame" />
    <param name="alpha_pos"         value="0.3" />
    <param name="alpha_rot"         value="0.3" />
  </node>

  <!-- 5. 理论 vs 视觉 cube 比对 -->
  <node pkg="jaka_close_contro" type="cube_nominal_compare_node" name="cube_nominal_compare" output="screen">
    <param name="robot_base_frame" value="Link_0" />
    <param name="robot_tool_frame" value="Link_6" />
    <param name="camera_frame" value="zed2i_left_camera_optical_frame" />
    <param name="cube_frame" value="cube_center" />
    <param name="cube_topic" value="/cube_center_fused" />
    <param name="tool_offset_yaml" value="$(arg tool_offset_yaml)" />
    <param name="output_csv" value="$(arg output_csv)" />
  </node>

</launch>
